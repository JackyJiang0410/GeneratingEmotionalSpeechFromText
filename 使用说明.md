# 脚本使用说明

## 准备工作

### 1. 确保数据文件已准备

文本文件应位于：
```
data/texts/
├── happy/
│   ├── 01.txt
│   ├── 02.txt
│   └── ...
├── sad/
├── angry/
├── tired/
├── excited/
└── neutral/
```

每个 `.txt` 文件包含**一行文本**（空行会被跳过）。

### 2. 确保环境已安装

- **F5-TTS 环境**：确保已创建并安装了 F5-TTS 的 conda 环境
- **Tortoise-TTS 环境**：确保已创建并安装了 Tortoise-TTS 的 conda 环境

## 使用步骤

### 方法一：分别运行（推荐）

#### 运行 F5-TTS 脚本

```bash
# 1. 激活 F5-TTS 环境
conda activate f5

# 2. 进入项目目录（如果还没在项目目录中）
cd /Users/haojiang/Desktop/EE381V/Project

# 3. 运行脚本
python scripts/run_f5_batch.py
```

**输出位置**：`outputs/f5/<emotion>/f5-<emotion>-XX.wav`

例如：
- `outputs/f5/happy/f5-happy-01.wav`
- `outputs/f5/sad/f5-sad-02.wav`

#### 运行 Tortoise-TTS 脚本

```bash
# 1. 激活 Tortoise-TTS 环境（如果之前在 f5 环境中，需要先退出）
conda deactivate  # 如果需要
conda activate tortoise

# 2. 进入项目目录（如果还没在项目目录中）
cd /Users/haojiang/Desktop/EE381V/Project

# 3. 运行脚本
python scripts/run_tortoise_batch.py
```

**输出位置**：`outputs/tortoise/<emotion>/tortoise-<emotion>-XX.wav`

例如：
- `outputs/tortoise/happy/tortoise-happy-01.wav`
- `outputs/tortoise/sad/tortoise-sad-02.wav`

### 方法二：一键运行脚本

你也可以创建一个便捷的批处理脚本来依次运行两个模型。

## 运行示例

### F5-TTS 运行示例

```bash
$ conda activate f5
$ python scripts/run_f5_batch.py

Loading F5-TTS model...
F5-TTS model loaded successfully!

Processing emotion: happy
  Using default reference audio: /path/to/basic_ref_en.wav
  Found 3 text files
  Generating: 01.txt -> f5-happy-01.wav
    Text: I'm so happy and excited about this wonderful day!...
    ✓ Saved: outputs/f5/happy/f5-happy-01.wav
  ...

Processing emotion: sad
  ...

F5-TTS batch processing completed!
```

### Tortoise-TTS 运行示例

```bash
$ conda activate tortoise
$ python scripts/run_tortoise_batch.py

Loading Tortoise-TTS model...
Tortoise-TTS model loaded successfully!

Processing emotion: happy
  No reference audio found, using random conditioning latents
  Found 3 text files
  Generating: 01.txt -> tortoise-happy-01.wav
    Text: I'm so happy and excited about this wonderful day!...
    ✓ Saved: outputs/tortoise/happy/tortoise-happy-01.wav
  ...

Tortoise-TTS batch processing completed!
```

## 输出文件对应关系

相同的输入文件在两个模型上生成的输出文件会有一一对应关系：

| 输入文件 | F5-TTS 输出 | Tortoise-TTS 输出 |
|---------|------------|------------------|
| `data/texts/happy/01.txt` | `outputs/f5/happy/f5-happy-01.wav` | `outputs/tortoise/happy/tortoise-happy-01.wav` |
| `data/texts/happy/02.txt` | `outputs/f5/happy/f5-happy-02.wav` | `outputs/tortoise/happy/tortoise-happy-02.wav` |
| `data/texts/sad/01.txt` | `outputs/f5/sad/f5-sad-01.wav` | `outputs/tortoise/sad/tortoise-sad-01.wav` |

这样便于对比两个模型在相同输入上的表现。

## 注意事项

1. **环境切换**：F5-TTS 和 Tortoise-TTS 需要在不同的 conda 环境中运行，因为它们可能有不同的依赖要求。

2. **参考音频（可选）**：
   - 如果需要使用自定义参考音频，将其放在 `data/references/` 目录下
   - 命名格式：`<emotion>_ref.wav`（如 `happy_ref.wav`）
   - 如果不存在，F5-TTS 会使用默认参考音频，Tortoise-TTS 会使用随机 conditioning latents

3. **运行时间**：
   - 生成音频可能需要较长时间，请耐心等待
   - Tortoise-TTS 使用 'fast' preset 以加快生成速度

4. **错误处理**：
   - 如果某个文件生成失败，脚本会继续处理其他文件
   - 错误信息会显示在控制台中

5. **覆盖输出**：
   - 如果输出文件已存在，会被新生成的文件覆盖

## 常见问题

**Q: 如果遇到导入错误怎么办？**
A: 确保在正确的 conda 环境中，并且模型目录存在：
- F5-TTS: `models/F5-TTS/`
- Tortoise-TTS: `models/tortoise-tts/`

**Q: 如何添加新的文本文件？**
A: 直接在对应的情绪目录下添加新的 `.txt` 文件，脚本会自动处理。

**Q: 如何只生成特定情绪的音频？**
A: 可以从脚本中修改 `emotions` 列表，只保留需要的情绪。

